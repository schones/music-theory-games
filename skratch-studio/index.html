<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skratch Studio — Music Theory Games</title>
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="studio.css">
  <!-- Blockly -->
  <script src="https://unpkg.com/blockly/blockly_compressed.js"></script>
  <script src="https://unpkg.com/blockly/blocks_compressed.js"></script>
  <script src="https://unpkg.com/blockly/javascript_compressed.js"></script>
  <script src="https://unpkg.com/blockly/msg/en.js"></script>
  <!-- FieldColour was removed from Blockly core in v12; load as plugin -->
  <script src="https://unpkg.com/@blockly/field-colour"></script>
  <!-- Tone.js for audio synthesis -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
</head>
<body style="background: #11111b; color: #cdd6f4; overflow: hidden;">
  <header class="mtt-header" style="background: #181825; border-bottom: 1px solid #3a3a50;">
    <a href="../index.html" class="mtt-header__logo" style="text-decoration: none;">
      <span aria-hidden="true">&#9835;</span> Music Theory Games
    </a>
    <nav class="mtt-header__nav">
      <a href="../index.html" class="mtt-header__link">Home</a>
      <a href="#" class="mtt-header__link mtt-header__link--active">Skratch Studio</a>
    </nav>
  </header>

  <main class="studio-layout">
    <!-- Left: Blockly Workspace -->
    <div class="studio-left">
      <div class="blockly-container">
        <div id="blocklyDiv"></div>
      </div>
    </div>

    <!-- Right: Canvas + Controls + Code Preview -->
    <div class="studio-right">
      <div class="canvas-panel">
        <div class="canvas-wrapper canvas-grid-bg">
          <canvas id="skratchCanvas" width="400" height="400"></canvas>
        </div>
        <div id="errorBar" class="error-bar" hidden></div>
        <div class="studio-controls">
          <button id="btnPlay" class="btn btn--play" aria-label="Play">&#9654; Play</button>
          <button id="btnStop" class="btn btn--stop" disabled aria-label="Stop">&#9632; Stop</button>
          <div id="beatIndicator" class="beat-indicator" aria-label="Beat indicator"></div>
          <select id="starterSelect" class="starter-select" aria-label="Load a starter program">
            <option value="">Load a starter...</option>
            <optgroup label="Visual">
              <option value="circles">Circles</option>
              <option value="rainbow">Rainbow Grid</option>
              <option value="spiral">Spiral</option>
              <option value="sound_circles">Sound Circles</option>
              <option value="note_garden">Note Garden</option>
              <option value="bounce">Bounce</option>
            </optgroup>
            <optgroup label="Music">
              <option value="first_beat">First Beat</option>
              <option value="bass_groove">Bass Groove</option>
              <option value="my_first_song">My First Song</option>
              <option value="beat_painter">Beat Painter</option>
            </optgroup>
            <option value="blank">Blank Canvas</option>
          </select>
        </div>
        <!-- Audio controls: piano + mic + BPM -->
        <div class="audio-controls">
          <div class="audio-controls__row">
            <button id="btnMic" class="btn btn--mic" aria-label="Toggle microphone">&#127908; Mic Off</button>
            <div class="bpm-control">
              <label for="bpmSlider" class="bpm-control__label">BPM</label>
              <input id="bpmSlider" type="range" min="60" max="180" value="120" class="bpm-control__slider" aria-label="Beats per minute">
              <span id="bpmValue" class="bpm-control__value">120</span>
            </div>
            <div class="volume-control">
              <label for="volumeSlider" class="bpm-control__label">VOL</label>
              <input id="volumeSlider" type="range" min="0" max="100" value="75" class="bpm-control__slider" aria-label="Volume">
              <span id="volumeValue" class="bpm-control__value">75%</span>
            </div>
          </div>
          <div id="pianoContainer" class="piano-container"></div>
        </div>
      </div>

      <div class="code-preview">
        <div class="code-preview__header" id="codePreviewHeader" role="button" tabindex="0" aria-expanded="true" aria-controls="codePreviewBody">
          <div>
            <span class="code-preview__title">See the Code</span>
            <span class="code-preview__subtitle">Real JavaScript — visuals use Canvas API, music uses Tone.js!</span>
          </div>
          <div class="code-preview__actions">
            <button id="btnCopy" class="btn--copy" aria-label="Copy code">Copy</button>
            <span id="codePreviewToggle" class="code-preview__toggle open" aria-hidden="true">&#9660;</span>
          </div>
        </div>
        <div class="code-preview__body" id="codePreviewBody">
          <pre class="code-preview__code" id="codePreviewContent">// Drag blocks to start coding!</pre>
        </div>
      </div>
    </div>
  </main>

  <script type="module">
    import { init } from './studio.js';
    init();
  </script>
</body>
</html>
